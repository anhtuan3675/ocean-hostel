USE OCEAN_HOSTEL
GO


CREATE	FUNCTION	FUNC__LOAIPHONG__GetNextID()
RETURNS VARCHAR(15)
AS
BEGIN
	DECLARE @MAXID INT

	SELECT @MAXID = CONVERT(INT, MAX(SUBSTRING(MALOAIPHG, 10, LEN(MALOAIPHG) - 9)))
	FROM LOAIPHONG
	
	---------------------------------
	IF (@MAXID IS NULL)
		SET @MAXID = '0'
	
	
	DECLARE @DISTANCE INT
	IF (LEN(@MAXID + 1) > LEN(@MAXID))	--	Trường hợp chữ số cuối cùng của đơn vị
		SET @DISTANCE = 6 - (LEN(@MAXID) + 1)
	ELSE
		SET @DISTANCE = 6 - LEN(@MAXID)
	
	---------------------------------
	DECLARE @RESULT VARCHAR(15)
	SET @RESULT = 'LOAIPHONG' + REPLICATE('0', @DISTANCE) + CONVERT(VARCHAR, @MAXID + 1)
	
	RETURN @RESULT + CONVERT(VARCHAR, @MAXID + 1)
END